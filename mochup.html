<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mockup Creator</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f0f2f5;
      --card: #fff;
      --text: #333;
      --accent: #4A90E2;
      --shadow: rgba(0,0,0,0.1);
    }
    *, *::before, *::after { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-bottom: 200px;
    }
    .container {
      background: var(--card);
      border-radius: 12px;
      box-shadow: 0 6px 18px var(--shadow);
      width: 100%; max-width: 700px;
      padding: 32px;
      margin-bottom: 20px;
    }
    h1 { text-align: center; margin-bottom: 24px; font-size: 2rem; }
    label { display: block; font-weight: 500; margin: 16px 0 8px; }
    input[type="file"] {
      width: 100%; padding: 10px;
      border: 1px solid #ccc; border-radius: 8px;
      background: #fafafa;
    }
    .thumbnail-container {
      display: flex; flex-wrap: wrap;
      gap: 12px; justify-content: center;
      margin: 16px 0;
    }
    .thumbnail-container img {
      width: 80px; height: 80px;
      object-fit: cover; border-radius: 8px;
      cursor: pointer; border: 2px solid transparent;
      box-shadow: 0 4px 12px var(--shadow);
    }
    .thumbnail-container img.selected { border-color: var(--accent); }
    .no-mockups { text-align: center; color: #777; margin: 16px 0; }
    canvas {
      width: 100%; height: auto;
      margin: 32px 0; border-radius: 8px;
      box-shadow: 0 6px 18px var(--shadow);
      background: #fff;
      touch-action: none;
    }
    #controls-container {
      position: fixed; bottom: 0; left: 0;
      width: 100%; background: var(--card);
      padding: 12px 20px;
      box-shadow: 0 -4px 12px var(--shadow);
      display: flex; justify-content: center;
      align-items: center; gap: 12px;
      z-index: 100;
    }
    .control-btn {
      background: #eee; border: none;
      border-radius: 6px; padding: 8px;
      cursor: pointer; font-size: 1.2rem;
    }
    .control-btn:hover { background: var(--accent); color: #fff; }
    select {
      padding: 6px 8px; border-radius: 6px;
      border: 1px solid #ccc;
    }
    #download-btn {
      padding: 10px 16px; background: var(--accent);
      color: #fff; border: none;
      border-radius: 8px; font-size: 1rem;
      cursor: pointer; box-shadow: 0 4px 12px var(--shadow);
    }
    #download-btn:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 8px 24px var(--shadow);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Mockup Creator</h1>
    <label for="add-mockup-input">Upload a mockup (JPG/PNG)</label>
    <input type="file" id="add-mockup-input" accept="image/*">
    <div id="mockup-thumbnails" class="thumbnail-container"></div>
    <div id="no-mockups-msg" class="no-mockups">No mockups yet — upload one above.</div>
    <label for="design-input">Select your design (PNG)</label>
    <input type="file" id="design-input" accept="image/png">
    <canvas id="mockup-canvas"></canvas>
    <button id="download-btn">Download Mockup</button>
  </div>

  <div id="controls-container">
    <!-- Scale Controls -->
    <button class="control-btn" data-target="scale" data-step="-0.01">▼</button>
    <button class="control-btn" data-target="scale" data-step="0.01">▲</button>
    <!-- X Offset Controls -->
    <button class="control-btn" data-target="offsetX" data-step="-1">◀</button>
    <button class="control-btn" data-target="offsetX" data-step="1">▶</button>
    <!-- Y Offset Controls -->
    <button class="control-btn" data-target="offsetY" data-step="-1">▲</button>
    <button class="control-btn" data-target="offsetY" data-step="1">▼</button>
    <!-- Resolution -->
    <select id="resolution-select">
      <option value="1">1×</option>
      <option value="2" selected>2×</option>
      <option value="3">3×</option>
      <option value="4">4×</option>
    </select>
  </div>

  <script>
    const canvas = document.getElementById('mockup-canvas'), ctx = canvas.getContext('2d');
    let mockupImages = {}, designImg = null;
    let scale = 1.00, offsetX = 0, offsetY = 0;
    let touchMode = null, initDist = 0, initScale = 1, initOffset = { x: 0, y: 0 };

    const addMockupInput = document.getElementById('add-mockup-input');
    const thumbnails = document.getElementById('mockup-thumbnails');
    const noMsg = document.getElementById('no-mockups-msg');
    const designInput = document.getElementById('design-input');
    const downloadBtn = document.getElementById('download-btn');

    function loadStoredMockups() {
      mockupImages = JSON.parse(localStorage.getItem('mockupImages') || '{}');
    }

    function renderThumbnails() {
      thumbnails.innerHTML = '';
      const keys = Object.keys(mockupImages);
      if (!keys.length) {
        noMsg.style.display = 'block';
        return;
      }
      noMsg.style.display = 'none';
      keys.forEach(label => {
        const img = document.createElement('img');
        img.src = mockupImages[label];
        img.alt = label;
        img.onclick = () => selectMockup(label, img);
        thumbnails.appendChild(img);
      });
      selectMockup(keys[0], thumbnails.firstChild);
    }

    function selectMockup(label, imgEl) {
      document.querySelectorAll('.thumbnail-container img').forEach(i => i.classList.remove('selected'));
      imgEl.classList.add('selected');
      const bg = new Image();
      bg.onload = () => {
        canvas.width = bg.width;
        canvas.height = bg.height;
        drawCanvas();
      };
      bg.src = mockupImages[label];
      window.bgImg = bg;
      localStorage.setItem('mockupImages', JSON.stringify(mockupImages));
    }

    function drawCanvas() {
      if (!window.bgImg) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(window.bgImg, 0, 0);
      if (designImg) {
        const w = designImg.width * scale;
        const h = designImg.height * scale;
        const x = (canvas.width - w) / 2 + (offsetX / 100) * canvas.width;
        const y = (canvas.height - h) / 2 + (offsetY / 100) * canvas.height;
        ctx.drawImage(designImg, x, y, w, h);
      }
    }

    addMockupInput.onchange = e => {
      const f = e.target.files[0]; if (!f) return;
      const reader = new FileReader();
      reader.onload = () => {
        mockupImages[f.name] = reader.result;
        localStorage.setItem('mockupImages', JSON.stringify(mockupImages));
        renderThumbnails();
      };
      reader.readAsDataURL(f);
    };

    designInput.onchange = e => {
      const f = e.target.files[0]; if (!f) return;
      designImg = new Image();
      designImg.onload = () => drawCanvas();
      designImg.src = URL.createObjectURL(f);
    };

    // Control buttons
    document.querySelectorAll('.control-btn').forEach(btn => {
      btn.onclick = () => {
        const step = parseFloat(btn.dataset.step);
        const tgt = btn.dataset.target;
        if (tgt === 'scale') scale = Math.min(Math.max(scale + step, 0.1), 2);
        if (tgt === 'offsetX') offsetX = Math.min(Math.max(offsetX + step, -50), 50);
        if (tgt === 'offsetY') offsetY = Math.min(Math.max(offsetY + step, -50), 50);
        drawCanvas();
      };
    });

    // Touch gestures
    canvas.addEventListener('touchstart', e => {
      e.preventDefault();
      const t = e.touches;
      if (t.length === 1) {
        touchMode = 'pan';
        initOffset = { x: offsetX, y: offsetY };
        initDist = null;
      } else if (t.length === 2) {
        touchMode = 'pinch';
        initDist = Math.hypot(t[0].clientX - t[1].clientX, t[0].clientY - t[1].clientY);
        initScale = scale;
      }
    });

    canvas.addEventListener('touchmove', e => {
      e.preventDefault();
      const t = e.touches;
      if (touchMode === 'pan' && t.length === 1) {
        const dx = (t[0].clientX - e.target.offsetLeft - canvas.width/2) / canvas.width * 100;
        const dy = (t[0].clientY - e.target.offsetTop - canvas.height/2) / canvas.height * 100;
        offsetX = Math.min(Math.max(initOffset.x + dx, -50), 50);
        offsetY = Math.min(Math.max(initOffset.y + dy, -50), 50);
        drawCanvas();
      } else if (touchMode === 'pinch' && t.length === 2) {
        const dist = Math.hypot(t[0].clientX - t[1].clientX, t[0].clientY - t[1].clientY);
        scale = Math.min(Math.max(initScale * (dist / initDist), 0.1), 2);
        drawCanvas();
      }
    });

    canvas.addEventListener('touchend', e => { if (e.touches.length === 0) touchMode = null; });

    // Download
    downloadBtn.onclick = () => {
      const m = parseInt(document.getElementById('resolution-select').value, 10);
      const ex = document.createElement('canvas'), exCtx = ex.getContext('2d');
      ex.width = canvas.width * m; ex.height = canvas.height * m; exCtx.scale(m, m);
      exCtx.drawImage(window.bgImg, 0, 0);
      if (designImg) {
        const w = designImg.width * scale;
        const h = designImg.height * scale;
        const x = (canvas.width - w) / 2 + (offsetX / 100) * canvas.width;
        const y = (canvas.height - h) / 2 + (offsetY / 100) * canvas.height;
        exCtx.drawImage(designImg, x, y, w, h);
      }
      ex.toBlob(blob => { const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `mockup@${m}x.png`; a.click(); URL.revokeObjectURL(a.href); }, 'image/png');
    };

    // Init
    loadStoredMockups(); renderThumbnails();
  </script>
</body>
</html>
