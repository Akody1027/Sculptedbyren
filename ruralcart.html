<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#2ecc71">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>RuralRun</title>

    <!-- 1. External Libraries (Leaflet for Maps, FontAwesome for Icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>

    <!-- 2. Professional App Styling -->
    <style>
        :root {
            --primary: #2ecc71; /* Uber Green */
            --primary-dark: #27ae60;
            --secondary: #3498db; /* Driver Blue */
            --danger: #e74c3c;
            --dark: #2c3e50;
            --light: #f5f6fa;
            --grey: #bdc3c7;
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        body {
            margin: 0;
            background-color: var(--light);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- App Shell --- */
        .view {
            display: none;
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 90px; /* Space for nav */
            animation: fadeIn 0.3s ease;
        }

        .view.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h1, h2, h3 { margin-top: 0; color: var(--dark); }
        p { color: #7f8c8d; line-height: 1.5; }

        /* --- Components --- */
        .card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            width: 100%;
            cursor: pointer;
            margin-top: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.98); }
        .btn-blue { background: var(--secondary); }
        .btn-red { background: var(--danger); }
        .btn-outline { background: transparent; border: 2px solid #ddd; color: var(--dark); }

        input, select {
            width: 100%;
            padding: 14px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 10px;
            background: #fff;
        }
        input:focus { outline: none; border-color: var(--primary); }

        /* --- Map Container --- */
        #map-container {
            height: 250px;
            width: 100%;
            border-radius: 12px;
            margin-bottom: 15px;
            z-index: 1;
        }

        /* --- Bottom Nav --- */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: white;
            display: none; /* Hidden on gateway */
            justify-content: space-around;
            padding: 12px 0 calc(12px + var(--safe-bottom)) 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            z-index: 1000;
        }
        .nav-item {
            text-align: center;
            color: var(--grey);
            font-size: 10px;
            flex: 1;
        }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .nav-icon { font-size: 22px; display: block; margin-bottom: 4px; }

        /* --- Toggle Switch --- */
        .switch {
            position: relative; display: inline-block; width: 50px; height: 28px; float: right;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc; transition: .4s; border-radius: 34px;
        }
        .slider:before {
            position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px;
            background-color: white; transition: .4s; border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(22px); }

        /* --- Invoice/Receipt Rows --- */
        .invoice-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; }
        .invoice-row.total { font-weight: bold; font-size: 18px; margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px; }
        .invoice-row.fee { color: #7f8c8d; font-size: 12px; }

        /* --- Gateway Specific --- */
        .gateway-split {
            height: 50vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: 0.2s;
        }
        .gateway-customer { background: white; color: var(--primary); }
        .gateway-driver { background: var(--secondary); color: white; }
        .gateway-split:active { opacity: 0.9; }

        /* --- Badge --- */
        .badge { background: #e8f8f5; color: var(--primary); padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
    </style>
</head>
<body>

    <!-- ================= VIEWS ================= -->

    <!-- 1. GATEWAY (First Load) -->
    <div id="view-gateway" style="display:block; padding:0; height:100vh;">
        <div class="gateway-split gateway-customer" onclick="app.openAuth('customer')">
            <i class="fas fa-shopping-basket fa-3x"></i>
            <h1>Order Delivery</h1>
            <p>Get goods delivered to your door.</p>
        </div>
        <div class="gateway-split gateway-driver" onclick="app.openAuth('driver')">
            <i class="fas fa-truck-pickup fa-3x"></i>
            <h1>Drive & Earn</h1>
            <p>Join the fleet. Be your own boss.</p>
        </div>
    </div>

    <!-- 2. AUTHENTICATION -->
    <div id="view-auth" class="view">
        <h2 id="auth-title" style="margin-top:40px;">Welcome</h2>
        <p id="auth-subtitle">Sign in to continue</p>
        
        <div class="card">
            <input type="email" id="email" placeholder="Email Address">
            <input type="password" id="password" placeholder="Password">
            
            <div id="driver-fields" style="display:none;">
                <hr style="border:0; border-top:1px solid #eee; margin:15px 0;">
                <p style="font-size:12px; font-weight:bold;">DRIVER APPLICATION</p>
                <input type="text" placeholder="Full Name">
                <input type="text" placeholder="Vehicle Make/Model">
                <input type="text" placeholder="License Number">
            </div>

            <button class="btn" onclick="app.login()">
                <span id="auth-btn-text">Sign In</span>
                <i class="fas fa-arrow-right"></i>
            </button>
            <button class="btn btn-outline" onclick="app.navTo('gateway')">Back</button>
        </div>
    </div>

    <!-- 3. CUSTOMER DASHBOARD -->
    <div id="view-customer" class="view">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>Order Delivery</h2>
            <div class="badge"><i class="fas fa-star"></i> VIP</div>
        </div>

        <!-- Address Selection -->
        <div class="card">
            <div id="map-container"></div>
            <p style="font-size:12px; color:var(--primary); text-align:center;">
                <i class="fas fa-map-pin"></i> Drag pin to your exact driveway
            </p>
            <input type="text" placeholder="Start typing store name (e.g. Walmart)...">
        </div>

        <!-- Delivery Type Selection -->
        <div class="card">
            <h3>Delivery Speed</h3>
            
            <!-- Standard -->
            <label style="display:flex; align-items:center; margin-bottom:15px;" onclick="app.updateTotal()">
                <input type="radio" name="speed" value="standard" checked style="width:20px; margin-right:10px;">
                <div>
                    <strong>Standard (Waitlist)</strong><br>
                    <small>Delivered Tomorrow â€¢ Flat Fee</small>
                </div>
                <div style="margin-left:auto;">$15.00</div>
            </label>

            <!-- Rush -->
            <label style="display:flex; align-items:center;" onclick="app.updateTotal()">
                <input type="radio" name="speed" value="rush" style="width:20px; margin-right:10px;">
                <div>
                    <strong>âš¡ Rush (Line Jumper)</strong><br>
                    <small>Delivered Today â€¢ Dynamic Bid</small>
                </div>
            </label>
            
            <!-- Bid Input (Hidden unless Rush) -->
            <div id="rush-bid-container" style="display:none; margin-top:10px; padding:10px; background:var(--light); border-radius:8px;">
                <label style="font-size:12px;">Your Offer (Bribe):</label>
                <input type="number" id="rush-amount" value="25.00" onchange="app.updateTotal()">
            </div>
        </div>

        <!-- Add-ons -->
        <div class="card">
            <label style="display:flex; justify-content:space-between; align-items:center;">
                <div style="display:flex; align-items:center;">
                    <input type="checkbox" id="white-glove" style="width:20px; margin-right:10px;" onchange="app.updateTotal()">
                    <div>
                        <strong>ðŸ§¤ White Glove Service</strong><br>
                        <small>Driver inspects items for damage</small>
                    </div>
                </div>
                <div>+$1.99</div>
            </label>
        </div>

        <!-- Invoice -->
        <div class="card">
            <div class="invoice-row"><span>Driver Pay (Base)</span><span>$15.00</span></div>
            <div class="invoice-row fee"><span>Platform & Dispatch Fee</span><span>$5.00</span></div>
            <div class="invoice-row" id="rush-row" style="display:none; color:var(--primary);"><span>âš¡ Rush Bribe</span><span id="rush-display">$0.00</span></div>
            <div class="invoice-row" id="glove-row" style="display:none;"><span>White Glove</span><span>$1.99</span></div>
            <div class="invoice-row total"><span>Total</span><span id="grand-total">$20.00</span></div>
            
            <button class="btn" onclick="alert('Proceeding to Stripe Payment...')">
                Pay & Book
            </button>
        </div>
    </div>

    <!-- 4. DRIVER DASHBOARD -->
    <div id="view-driver" class="view">
        <!-- Header Controls -->
        <div class="card" style="background:var(--dark); color:white;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <h2 style="color:white; margin:0;">Hi, Wife</h2>
                    <small>Admin / Dispatcher</small>
                </div>
                <label class="switch">
                    <input type="checkbox" checked onchange="app.toggleStatus(this)">
                    <span class="slider"></span>
                </label>
            </div>
            <p id="status-text" style="color:var(--primary); margin-top:5px; font-weight:bold;">ðŸŸ¢ OPEN: Accepting Orders</p>
        </div>

        <!-- Make Me Move Slider -->
        <div class="card">
            <h3>ðŸ’° Make Me Move</h3>
            <p>Set today's rush fee minimum.</p>
            <input type="range" min="10" max="50" step="5" value="25" oninput="document.getElementById('mmm-val').innerText = '$' + this.value">
            <div style="text-align:center; font-weight:bold; font-size:24px; color:var(--primary);" id="mmm-val">$25</div>
        </div>

        <!-- Magnet Mode -->
        <div class="card">
            <div style="display:flex; justify-content:space-between;">
                <h3>ðŸ§² Magnet Mode</h3>
                <label class="switch">
                    <input type="checkbox">
                    <span class="slider"></span>
                </label>
            </div>
            <p>Highlight orders within <strong>3 miles</strong> of my current route.</p>
        </div>

        <!-- Active Order List -->
        <h3>Pending Orders</h3>
        <div class="card">
            <div style="display:flex; justify-content:space-between;">
                <strong>Walmart -> Miller Farm</strong>
                <span class="badge" style="background:var(--danger); color:white;">Rush</span>
            </div>
            <p>5 items â€¢ 8.2 miles</p>
            <div style="display:flex; justify-content:space-between; margin-top:10px;">
                <strong>Payout: $42.00</strong>
                <button class="btn btn-blue" style="width:auto; padding:8px 15px; margin:0;" onclick="alert('Opening Route...')">Details</button>
            </div>
        </div>
    </div>

    <!-- ================= NAV BAR ================= -->
    <div class="bottom-nav" id="main-nav">
        <div class="nav-item active" id="nav-home" onclick="app.navToUserHome()">
            <i class="fas fa-home nav-icon"></i> Home
        </div>
        <div class="nav-item" onclick="alert('History Feature')">
            <i class="fas fa-history nav-icon"></i> History
        </div>
        <div class="nav-item" onclick="app.navTo('gateway')">
            <i class="fas fa-sign-out-alt nav-icon"></i> Logout
        </div>
    </div>

    <!-- ================= LOGIC ================= -->
    <script>
        // 1. MOCK FIREBASE CONFIG (Placeholders)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "ruralrun.firebaseapp.com",
            projectId: "ruralrun",
        };

        // 2. APP LOGIC CONTROLLER
        const app = {
            currentUserRole: 'customer', // 'customer' or 'driver'
            map: null,

            // Navigation Handler
            navTo: (viewId) => {
                // Hide all views
                document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
                document.getElementById('view-gateway').style.display = 'none';
                
                // Show requested view
                if(viewId === 'gateway') {
                    document.getElementById('view-gateway').style.display = 'block';
                    document.getElementById('main-nav').style.display = 'none';
                } else {
                    document.getElementById('view-' + viewId).classList.add('active');
                }
            },

            // Auth Flow
            openAuth: (role) => {
                app.currentUserRole = role;
                app.navTo('auth');
                
                if(role === 'driver') {
                    document.getElementById('driver-fields').style.display = 'block';
                    document.getElementById('auth-title').innerText = "Driver Application";
                    document.getElementById('auth-btn-text').innerText = "Submit Application";
                } else {
                    document.getElementById('driver-fields').style.display = 'none';
                    document.getElementById('auth-title').innerText = "Customer Login";
                    document.getElementById('auth-btn-text').innerText = "Sign In";
                }
            },

            login: () => {
                // SIMULATED LOGIN
                if(app.currentUserRole === 'driver') {
                    app.navTo('driver');
                    document.getElementById('main-nav').style.display = 'flex';
                } else {
                    app.navTo('customer');
                    document.getElementById('main-nav').style.display = 'flex';
                    app.initMap(); // Load map when customer logs in
                }
            },

            navToUserHome: () => {
                app.navTo(app.currentUserRole); // Go back to correct dashboard
            },

            // Map Initialization (Leaflet)
            initMap: () => {
                if(app.map) return; // Already loaded
                setTimeout(() => {
                    app.map = L.map('map-container').setView([35.0, -97.0], 13);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: 'Â© OpenStreetMap'
                    }).addTo(app.map);
                    
                    // Draggable Pin Logic
                    const marker = L.marker([35.0, -97.0], {draggable: true}).addTo(app.map);
                    marker.bindPopup("Drag me to your driveway!").openPopup();
                }, 500); // Small delay to allow view to render
            },

            // Pricing Calculator logic
            updateTotal: () => {
                const speed = document.querySelector('input[name="speed"]:checked').value;
                const whiteGlove = document.getElementById('white-glove').checked;
                
                let base = 15.00;
                let fee = 5.00;
                let rush = 0;
                let glove = 0;

                // 1. Handle Rush
                if(speed === 'rush') {
                    document.getElementById('rush-bid-container').style.display = 'block';
                    document.getElementById('rush-row').style.display = 'flex';
                    rush = parseFloat(document.getElementById('rush-amount').value) || 0;
                } else {
                    document.getElementById('rush-bid-container').style.display = 'none';
                    document.getElementById('rush-row').style.display = 'none';
                }

                // 2. Handle White Glove
                if(whiteGlove) {
                    glove = 1.99;
                    document.getElementById('glove-row').style.display = 'flex';
                } else {
                    document.getElementById('glove-row').style.display = 'none';
                }

                document.getElementById('rush-display').innerText = '$' + rush.toFixed(2);
                
                // 3. Final Math
                let total = base + fee + rush + glove;
                document.getElementById('grand-total').innerText = '$' + total.toFixed(2);
            },

            // Driver Status Toggle
            toggleStatus: (checkbox) => {
                const text = document.getElementById('status-text');
                if(checkbox.checked) {
                    text.innerText = "ðŸŸ¢ OPEN: Accepting Orders";
                    text.style.color = "var(--primary)";
                } else {
                    text.innerText = "ðŸ”´ CLOSED: Waitlist Only";
                    text.style.color = "var(--danger)";
                }
            }
        };

        // Initialize Pricing on Load
        app.updateTotal();

    </script>
</body>
</html>