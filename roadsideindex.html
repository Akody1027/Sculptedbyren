<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SOS Roadside Help</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- Google Maps -->
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_KEY"></script>

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
      background: #f5f5f5;
    }

    #map {
      height: 65vh;
      width: 100%;
    }

    #panel {
      height: 25vh;
      background: white;
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      padding: 15px;
      overflow-y: auto;
    }

    .request {
      border-bottom: 1px solid #eee;
      padding: 10px 0;
    }

    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 14px;
      border-radius: 10px;
      cursor: pointer;
    }

    /* ðŸ”´ SOS Footer */
    #footer {
      position: fixed;
      bottom: 0;
      width: 100%;
      height: 60px;
      background: #111;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #sosBtn {
      background: #e63946;
      font-size: 16px;
      font-weight: bold;
      padding: 12px 30px;
      border-radius: 30px;
    }

    /* Modal */
    #modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
    }

    #modalContent {
      background: white;
      width: 90%;
      max-width: 400px;
      padding: 20px;
      border-radius: 15px;
    }

    input, textarea {
      width: 100%;
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
  </style>
</head>
<body>

<div id="map"></div>

<div id="panel">
  <h3>Nearby SOS Requests</h3>
  <div id="requests"></div>
</div>

<!-- ðŸ”´ Footer SOS Button -->
<div id="footer">
  <button id="sosBtn" onclick="openSOS()">SEND SOS</button>
</div>

<!-- Modal -->
<div id="modal">
  <div id="modalContent">
    <h3>Send SOS</h3>
    <input id="name" placeholder="Your name">
    <textarea id="issue" rows="3" placeholder="Describe your issue"></textarea>
    <button onclick="submitSOS()">Submit</button>
  </div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "YOUR_FIREBASE_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT.firebaseio.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "XXXX",
    appId: "XXXX"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let map;
  let markers = {};
  let userLocation = null;

  function initMap() {
    navigator.geolocation.getCurrentPosition(pos => {
      userLocation = {
        lat: pos.coords.latitude,
        lng: pos.coords.longitude
      };

      map = new google.maps.Map(document.getElementById("map"), {
        center: userLocation,
        zoom: 13
      });

      new google.maps.Marker({
        position: userLocation,
        map,
        label: "You"
      });

      loadSOS();
    });
  }

  function loadSOS() {
    const container = document.getElementById("requests");

    db.ref("sosRequests").on("value", snap => {
      container.innerHTML = "";

      snap.forEach(child => {
        const data = child.val();
        if (data.status !== "open") return;

        if (!markers[child.key]) {
          markers[child.key] = new google.maps.Marker({
            position: { lat: data.lat, lng: data.lng },
            map
          });
        }

        const div = document.createElement("div");
        div.className = "request";
        div.innerHTML = `
          <strong>${data.userName}</strong>
          <p>${data.issue}</p>
          <button onclick="acceptSOS('${child.key}')">Accept</button>
        `;
        container.appendChild(div);
      });
    });
  }

  function acceptSOS(id) {
    db.ref("sosRequests/" + id).update({
      status: "accepted",
      acceptedBy: "MotorUser"
    });
  }

  function openSOS() {
    document.getElementById("modal").style.display = "flex";
  }

  function submitSOS() {
    const name = document.getElementById("name").value.trim();
    const issue = document.getElementById("issue").value.trim();

    if (!name || !issue || !userLocation) return;

    db.ref("sosRequests").push({
      userName: name,
      issue: issue,
      lat: userLocation.lat,
      lng: userLocation.lng,
      status: "open",
      timestamp: Date.now()
    });

    document.getElementById("modal").style.display = "none";
    document.getElementById("name").value = "";
    document.getElementById("issue").value = "";
  }

  initMap();
</script>

</body>
</html>
