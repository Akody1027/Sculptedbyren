<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Roadside Hero</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<!-- Google Maps with Geometry -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB5GbyoapPOyLYJLNo9y85cyorIczEI-WU&libraries=geometry"></script>

<style>
:root {
  --bg: #f8fafc; --card: #ffffff; --text: #0f172a; --muted: #64748b;
  --accent: #2563eb; --danger: #EE611C; --success: #22c55e; --warning: #f59e0b;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: -apple-system, system-ui, sans-serif; color: var(--text); background: white; overflow: hidden; }

/* --- VIEW MANAGER --- */
.view { display: none; width: 100vw; height: 100vh; position: fixed; inset: 0; z-index: 10; background: white; overflow-y: auto; }
.view-active { display: flex; flex-direction: column; }

/* --- LANDING PAGE --- */
#landingPage { align-items: center; justify-content: center; padding: 30px; text-align: center; z-index: 100; }
#landingPage img { width: 240px; margin-bottom: 10px; }
.mode-btn { width: 100%; max-width: 320px; padding: 20px; border-radius: 18px; font-size: 18px; font-weight: 700; border: none; cursor: pointer; margin-bottom: 16px; transition: 0.2s; }
.btn-req { background: var(--danger); color: white; box-shadow: 0 10px 20px rgba(239, 68, 68, 0.2); }
.btn-hero { background: var(--text); color: white; }

/* --- SEEKER DASHBOARD --- */
#seekerUI { background: var(--bg); padding: 20px; align-items: center; }
.status-card { background: white; width: 100%; max-width: 400px; padding: 25px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); text-align: center; margin-top: 20px; border: 1px solid #e2e8f0; }
.search-pulse { width: 80px; height: 80px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; color: white; margin: 0 auto 20px; position: relative; }
.search-pulse::after { content: ''; position: absolute; inset: 0; border-radius: 50%; background: var(--accent); opacity: 0.4; animation: pulse 2s infinite; }
@keyframes pulse { 0% { transform: scale(1); opacity: 0.4; } 100% { transform: scale(2); opacity: 0; } }

/* --- HERO UI --- */
#heroUI { overflow: hidden; }
#map { width: 100%; height: 100%; position: absolute; top:0; left:0; z-index: 1; }

  #heroPanel { width:100%; position: fixed; bottom: 80px;  z-index: 100; display: flex; flex-direction: column;  }

  .task-card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); border-left: 6px solid var(--accent); }
.browse-btn { background: white; padding: 18px;  text-align: center; font-weight: 700; box-shadow: 0 4px 15px rgba(0,0,0,0.1); cursor: pointer; }

/* --- MODALS --- */
.modal { position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: flex-end; z-index: 1000; }
.modal-content { background: white; width: 100%; max-width: 500px; border-radius: 30px 30px 0 0; padding: 25px; max-height: 90vh; overflow-y: auto; }

.vehicle-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0; }
.v-type { padding: 12px; border: 2px solid #f1f5f9; border-radius: 12px; text-align: center; cursor: pointer; font-weight: 600; font-size: 14px; }
.v-type.active { border-color: var(--accent); background: #eff6ff; color: var(--accent); }

.radius-container { display: flex; flex-wrap: wrap; gap: 6px; margin: 10px 0 20px; }
.radius-item { flex: 1 1 60px; position: relative; }
.radius-item input { position: absolute; opacity: 0; cursor: pointer; }
.radius-label { display: block; padding: 8px 2px; text-align: center; background: #f1f5f9; border-radius: 8px; font-size: 11px; cursor: pointer; }
.radius-item input:checked + .radius-label { background: var(--accent); color: white; }

input, textarea { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 12px; font-size: 15px; background: #f8fafc; }
.submit-btn { width: 100%; padding: 16px; background: var(--accent); color: white; border: none; border-radius: 14px; font-weight: 700; cursor: pointer; font-size: 16px; }
.cancel-link { display: block; text-align: center; padding: 15px; color: var(--muted); cursor: pointer; }

/* HISTORY & NOTIFICATIONS */
.history-item { padding: 15px; background: #f8fafc; border-radius: 15px; margin-bottom: 10px; border: 1px solid #e2e8f0; }
.status-pill { font-size: 10px; font-weight: 800; padding: 3px 8px; border-radius: 6px; text-transform: uppercase; float: right; color: white; }

/* FOOTER */
.footer { position: fixed; bottom: 0; width: 100%; height: 80px; background: #ee611c
; display: flex; justify-content: space-between; align-items: center; padding: 0 25px; z-index: 200; border-top: 1px solid #f1f5f9; }
.icon-btn { position: relative; cursor: pointer; width: 45px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; }
#notifBadge { position: absolute; top: -2px; right: -2px; background: var(--danger); color: white; font-size: 10px; width: 18px; height: 18px; border-radius: 50%; display: none; align-items: center; justify-content: center; border: 2px solid white; }
</style>
</head>
<body>

<!-- 1. LANDING PAGE -->
<div id="landingPage" class="view view-active">
    <img src="Roadsidelogo.png" alt="Roadside Hero Logo">
    <h2 style="color: var(--muted); margin-bottom: 40px; font-weight: 500;">Help is just a click away.</h2>
    <button class="mode-btn btn-req" onclick="window.openModal('requestModal')">Request Help!</button>
    <button class="mode-btn btn-hero" onclick="window.enterHeroMode()">Become a Hero!</button>
</div>

<!-- 2. SEEKER DASHBOARD -->
<div id="seekerUI" class="view">
    <button onclick="window.openModal('cancelConfirmModal')" style="align-self: flex-start; background: none; border: none; font-weight: 800; color: var(--danger); padding: 20px;">‚úï CANCEL SOS</button>
    
    <div id="searchingState" class="status-card">
        <div class="search-pulse">üì°</div>
        <h3>Broadcasting SOS...</h3>
        <p id="nearbyHelpers">Finding Heroes nearby...</p>
    </div>

    <div id="matchedState" class="status-card" style="display:none; border-color: var(--success);">
        <div style="background: var(--success); color: white; padding: 6px 16px; border-radius: 20px; display: inline-block; font-size: 12px; font-weight: 800; margin-bottom: 15px;">HERO CONNECTED</div>
        <div style="display: flex; align-items: center; gap: 15px; text-align: left;">
            <img id="matchPic" src="" style="width: 75px; height: 75px; border-radius: 50%; object-fit: cover; border: 2px solid var(--success);">
            <div>
                <h3 id="matchName" style="margin:0;">Hero Name</h3>
                <p id="matchDist" style="margin:5px 0; color: var(--accent); font-weight: 700;"></p>
                <p id="matchBio" style="font-size: 12px; color: var(--muted);"></p>
            </div>
        </div>
        <button class="submit-btn" style="background: var(--success); margin-top: 25px;" onclick="window.confirmArrival()">HELP HAS ARRIVED</button>
    </div>
</div>

<!-- 3. HERO UI -->
<div id="heroUI" class="view">
    <div id="map"></div>
    <div id="heroPanel">
        <div id="activeTask" class="task-card" style="display:none;">
            <div id="taskNormalView">
                <div style="display:flex; justify-content:space-between;">
                    <b style="color: var(--accent);">ONGOING ASSIGNMENT</b>
                    <span id="taskDist" style="font-weight:bold;">... mi</span>
                </div>
                <p id="taskUser" style="margin:12px 0; font-weight:700; font-size:16px;"></p>
                <div style="display:flex; gap:10px;">
                    <a id="navBtn" href="" target="_blank" style="flex:1; background:var(--success); color:white; text-align:center; padding:12px; border-radius:12px; text-decoration:none; font-weight:700;">NAVIGATE</a>
                    <button onclick="window.completeTask()" style="flex:1; border:1px solid #ddd; background:white; border-radius:12px; font-weight:700;">MARK FINISHED</button>
                </div>
            </div>
            <div id="taskCanceledView" style="display:none; text-align:center;">
                <b style="color:var(--danger)">SOS CANCELED BY USER</b>
                <p id="cancelReasonDisplay" style="font-size:13px; margin:10px 0;"></p>
                <button onclick="window.acknowledgeCancel()" class="submit-btn" style="background:var(--text); padding:10px;">CLOSE ALERT</button>
            </div>
        </div>
        <div class="browse-btn" onclick="window.openModal('browseModal')">
            üîç BROWSE REQUESTS (<span id="openCount">0</span>)
        </div>
    </div>
    <div class="footer">

        <div class="footer-icons" style="display:flex; gap:15px;">
            <img src="notificationicon.png" class="icon-btn" onclick="window.openModal('notifModal')" ><span id="notifBadge">0</span></img>
            <img src="thishomeicon.png" onclick="location.reload()" style="border:none; background:none; font-weight:800; color: var(--muted);"></img>
            <img src="usericon.png" class="icon-btn" onclick="window.openProfile()"></img>
        </div>
    </div>
</div>

<!-- MODALS -->
<div id="cancelConfirmModal" class="modal">
    <div class="modal-content">
        <h3>Cancel SOS?</h3>
        <p style="font-size:14px; color:var(--muted); margin-bottom:15px;">Please select why you are canceling:</p>
        <button class="submit-btn" style="background:var(--success); margin-bottom:10px;" onclick="window.submitCancellation('Issue Resolved')">Issue Resolved / Fixed</button>
        <button class="submit-btn" style="background:var(--accent); margin-bottom:10px;" onclick="window.submitCancellation('Found Other Helper')">Found Other Helper</button>
        <button class="submit-btn" style="background:var(--muted); margin-bottom:10px;" onclick="window.submitCancellation('Changed Mind')">Don't Need Help Now</button>
        <span class="cancel-link" onclick="window.closeModal('cancelConfirmModal')">Keep Request Active</span>
    </div>
</div>

<div id="requestModal" class="modal">
    <div class="modal-content">
        <h3>Request Assistance</h3>
        <label style="font-size:12px; font-weight:bold;">Vehicle Type</label>
        <div class="vehicle-grid">
            <div class="v-type active" onclick="window.selectVehicle('Car', this)">üöó Car</div>
            <div class="v-type" onclick="window.selectVehicle('Truck', this)">üõª Truck</div>
            <div class="v-type" onclick="window.selectVehicle('RV', this)">üöê RV</div>
            <div class="v-type" onclick="window.selectVehicle('HeavyDuty', this)">üöõ Heavy Duty</div>
        </div>
        <img id="damagePreview" style="width:100%; height:120px; object-fit:cover; border-radius:15px; margin-bottom:15px; display:none;">
        <input type="file" id="damageInput" accept="image/*" style="display:none" onchange="window.previewDamage(this)">
        <button onclick="document.getElementById('damageInput').click()" style="width:100%; padding:12px; border-radius:12px; border:2px dashed #ddd; background:none; margin-bottom:15px; cursor:pointer; font-weight:bold; color:var(--muted);">üì∑ Add Damage Photo</button>
        <textarea id="reqIssue" placeholder="What's the problem?" rows="2"></textarea>
        <input id="reqTip" type="number" placeholder="Optional Tip for Hero ($)">
        <button class="submit-btn" onclick="window.submitSOS()">SUBMIT SOS</button>
        <p onclick="window.closeModal('requestModal')" class="cancel-link">Cancel</p>
    </div>
</div>

<div id="profileModal" class="modal">
    <div class="modal-content">
        <h3>Hero Profile & Radius</h3>
        <div style="text-align:center; margin-bottom:15px;">
            <img id="profileDisplayPic" src="https://via.placeholder.com/85" style="width:85px; height:85px; border-radius:50%; object-fit:cover; border:3px solid var(--accent);">
            <input type="file" id="picInput" style="display:none" onchange="window.previewProfilePic(this)">
            <button onclick="document.getElementById('picInput').click()" style="display:block; margin:5px auto; border:none; background:none; color:var(--accent); font-weight:bold; cursor:pointer;">Update Photo</button>
        </div>
        <div style="text-align:center; margin-bottom:15px; font-size:14px;">Total Assists: <b id="heroCountDisplay">0</b></div>
        <input id="profileName" placeholder="Hero Name">
        <textarea id="profileBio" placeholder="Bio / Tools Available..." rows="2"></textarea>
        <label style="font-size:12px; font-weight:bold;">Service Travel Radius</label>
        <div class="radius-container" id="radiusSelector"></div>
        <button class="submit-btn" onclick="window.saveProfile()">Save Settings</button>
        <span class="cancel-link" onclick="window.closeModal('profileModal')">Close</span>
    </div>
</div>

<div id="browseModal" class="modal"><div class="modal-content"><h3>Requests in Radius</h3><div id="browseList"></div><button class="submit-btn" style="background:#f1f5f9; color:var(--text); margin-top:15px;" onclick="window.closeModal('browseModal')">CLOSE</button></div></div>
<div id="notifModal" class="modal"><div class="modal-content"><h3>History</h3><div id="notifHistory"></div><button class="submit-btn" style="background:#f1f5f9; color:var(--text); margin-top:15px;" onclick="window.closeModal('notifModal')">CLOSE</button></div></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, push, onValue, set, get, update, remove, query, orderByChild, endAt } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBgXWZkH0WMjhGmOfxjqbIDoJHlyA1pc-o",
  authDomain: "roadsidehero-104ea.firebaseapp.com",
  databaseURL: "https://roadsidehero-104ea-default-rtdb.firebaseio.com",
  projectId: "roadsidehero-104ea",
  storageBucket: "roadsidehero-104ea.firebasestorage.app"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

if(!localStorage.getItem('heroUserId')) localStorage.setItem('heroUserId', 'u_' + Math.random().toString(36).substr(2, 9));
const myId = localStorage.getItem('heroUserId');

let map, userLocation, selectedVehicle = "Car", damageImgData = null, myRadius = 50;
let sosCache = {}, profilesCache = {}, markers = {};
const radiusOptions = [5, 10, 15, 20, 30, 40, 50, 100, 150, 200, 300, 999999];

// --- WINDOW FUNCTIONS ---
window.openModal = (id) => document.getElementById(id).style.display = "flex";
window.closeModal = (id) => document.getElementById(id).style.display = "none";
window.switchView = (id) => {
    document.querySelectorAll('.view').forEach(v => v.classList.remove('view-active'));
    document.getElementById(id).classList.add('view-active');
};
window.selectVehicle = (type, el) => {
    selectedVehicle = type;
    document.querySelectorAll(".v-type").forEach(b => b.classList.remove("active"));
    el.classList.add("active");
};

// --- IMAGES ---
window.previewDamage = (input) => {
    const reader = new FileReader();
    reader.onload = (e) => {
        damageImgData = e.target.result;
        document.getElementById('damagePreview').src = damageImgData;
        document.getElementById('damagePreview').style.display = 'block';
    };
    reader.readAsDataURL(input.files[0]);
};
window.previewProfilePic = (input) => {
    const reader = new FileReader();
    reader.onload = (e) => document.getElementById('profileDisplayPic').src = e.target.result;
    reader.readAsDataURL(input.files[0]);
};

// --- PROFILE ---
window.setMyRadius = (val) => { myRadius = val; };
window.saveProfile = () => {
    update(ref(db, `profiles/${myId}`), { name: document.getElementById("profileName").value, bio: document.getElementById("profileBio").value, pic: document.getElementById("profileDisplayPic").src, serviceRadius: myRadius });
    if(map && userLocation) window.updateMapView();
    window.closeModal("profileModal");
};
window.openProfile = async () => {
    window.openModal("profileModal");
    const snap = await get(ref(db, `profiles/${myId}`));
    if(snap.exists()) {
        const d = snap.val();
        document.getElementById("profileName").value = d.name || "";
        document.getElementById("profileBio").value = d.bio || "";
        document.getElementById("heroCountDisplay").innerText = d.helpsCount || 0;
        if(d.pic) document.getElementById("profileDisplayPic").src = d.pic;
        if(d.serviceRadius) { myRadius = d.serviceRadius; const rIn = document.getElementById('r' + d.serviceRadius); if(rIn) rIn.checked = true; }
    }
};

// --- HERO LOGIC ---
window.enterHeroMode = () => {
    window.switchView('heroUI');
    setTimeout(() => { if(!map) initMap(); }, 200);
};
window.updateMapView = () => {
    if (!map || !userLocation) return;
    if (myRadius >= 999999) { map.setCenter({ lat: 39.8, lng: -98.5 }); map.setZoom(4); }
    else { const circle = new google.maps.Circle({ center: userLocation, radius: myRadius * 1609.34 }); map.fitBounds(circle.getBounds()); }
};
window.confirmHelp = (sosId) => {
    update(ref(db, `sosRequests/${sosId}`), { status: 'accepted', helperId: myId, helperAcknowledged: false });
    window.closeModal('browseModal');
};

// FIXED: Now updates the database so the syncUI stops showing the alert
window.acknowledgeCancel = () => {
    const myCanceledTaskEntry = Object.entries(sosCache).find(([id, r]) => r.helperId === myId && r.status === 'canceled');
    if(myCanceledTaskEntry) {
        update(ref(db, `sosRequests/${myCanceledTaskEntry[0]}`), { helperAcknowledged: true });
    }
};

window.completeTask = async () => {
    const myActive = Object.entries(sosCache).find(([id, r]) => r.helperId === myId && r.status === 'accepted');
    if(!myActive) return;
    const snap = await get(ref(db, `profiles/${myId}`));
    const count = snap.exists() ? (snap.val().helpsCount || 0) : 0;
    update(ref(db, `profiles/${myId}`), { helpsCount: count + 1 });
    update(ref(db, `sosRequests/${myActive[0]}`), { status: 'completed' });
};

// --- SEEKER LOGIC ---
window.submitSOS = () => {
    const issue = document.getElementById('reqIssue').value;
    if(!issue || !userLocation) return alert("Describe issue and allow GPS.");
    push(ref(db, "sosRequests"), {
        ownerId: myId, userName: "User", issue, tip: document.getElementById('reqTip').value || 0,
        vehicle: selectedVehicle, damagePic: damageImgData,
        lat: userLocation.lat, lng: userLocation.lng, status: 'open', timestamp: Date.now()
    });
    window.closeModal('requestModal');
    window.switchView('seekerUI');
};
window.submitCancellation = (reason) => {
    const myReqId = Object.keys(sosCache).find(k => sosCache[k].ownerId === myId && (sosCache[k].status === 'open' || sosCache[k].status === 'accepted'));
    if(myReqId) {
        update(ref(db, `sosRequests/${myReqId}`), { status: 'canceled', cancelReason: reason });
    }
    window.closeModal('cancelConfirmModal');
    location.reload(); 
};
window.confirmArrival = () => window.completeTask();

// --- MAP & SYNC ---
function initMap() {
    map = new google.maps.Map(document.getElementById("map"), { center: userLocation || {lat: 40, lng: -74}, zoom: 14, disableDefaultUI: true });
    if(userLocation) {
        new google.maps.Marker({ position: userLocation, map, icon: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png" });
        window.updateMapView();
    }
}

onValue(ref(db, "sosRequests"), (snap) => {
    sosCache = snap.val() || {};
    syncUI();
});

onValue(ref(db, "profiles"), (snap) => {
    profilesCache = snap.val() || {};
    syncUI();
});

function syncUI() {
    const list = document.getElementById('browseList');
    const history = document.getElementById('notifHistory');
    const badge = document.getElementById('notifBadge');
    list.innerHTML = ""; history.innerHTML = "";
    let openCount = 0; let myTask = null; let myActiveSOS = null;

    Object.entries(sosCache).forEach(([id, r]) => {
        const dist = userLocation ? (google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(userLocation.lat, userLocation.lng), new google.maps.LatLng(r.lat, r.lng)) / 1609).toFixed(1) : "?";
        const inRadius = (myRadius >= 999999 || dist <= myRadius);

        if(r.status === 'open' && r.ownerId !== myId && inRadius) {
            openCount++;
            list.innerHTML += `<div class="history-item"><b>${r.vehicle}: ${r.issue}</b><br>${dist} mi away<br><button class="submit-btn" style="margin-top:10px; padding:8px;" onclick="window.confirmHelp('${id}')">HELP THEM</button></div>`;
            if(!markers[id] && map) {
                markers[id] = new google.maps.Marker({ position: {lat: r.lat, lng: r.lng}, map: map, icon: "http://maps.google.com/mapfiles/ms/icons/red-dot.png", title: r.issue });
            }
        } else {
            if(markers[id]) { markers[id].setMap(null); delete markers[id]; }
        }
        
        // Track task for Hero: Only show if accepted OR (canceled and not yet acknowledged)
        if(r.helperId === myId && (r.status === 'accepted' || (r.status === 'canceled' && !r.helperAcknowledged))) {
            myTask = r;
        }

        if(r.ownerId === myId && (r.status === 'open' || r.status === 'accepted')) myActiveSOS = r;

        let statusColor = '#2563eb'; 
        if(r.status === 'completed') statusColor = '#22c55e'; 
        if(r.status === 'canceled') statusColor = '#ef4444'; 
        history.innerHTML += `<div class="history-item"><span class="status-pill" style="background:${statusColor};">${r.status}</span><b>${r.userName}</b><br>${r.issue}</div>`;
    });

    const taskCard = document.getElementById('activeTask');
    if(myTask) {
        taskCard.style.display = "block";
        if(myTask.status === 'canceled') {
            document.getElementById('taskNormalView').style.display = 'none';
            document.getElementById('taskCanceledView').style.display = 'block';
            document.getElementById('cancelReasonDisplay').innerText = `Reason: ${myTask.cancelReason || 'Not specified'}`;
        } else {
            document.getElementById('taskNormalView').style.display = 'block';
            document.getElementById('taskCanceledView').style.display = 'none';
            document.getElementById('taskUser').innerText = `Helping with ${myTask.issue}`;
            document.getElementById('navBtn').href = `https://www.google.com/maps/dir/?api=1&destination=${myTask.lat},${myTask.lng}`;
            document.getElementById('taskDist').innerText = userLocation ? (google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(userLocation.lat, userLocation.lng), new google.maps.LatLng(myTask.lat, myTask.lng)) / 1609).toFixed(1) + " mi" : "";
        }
    } else { taskCard.style.display = "none"; }

    if(myActiveSOS) {
        window.switchView('seekerUI');
        if(myActiveSOS.status === 'accepted') {
            document.getElementById('searchingState').style.display = 'none';
            document.getElementById('matchedState').style.display = 'block';
            const hero = profilesCache[myActiveSOS.helperId] || {};
            document.getElementById('matchName').innerText = hero.name || "A Hero";
            document.getElementById('matchPic').src = hero.pic || "https://via.placeholder.com/85";
            const hDist = userLocation ? (google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(userLocation.lat, userLocation.lng), new google.maps.LatLng(myActiveSOS.lat, myActiveSOS.lng)) / 1609).toFixed(1) : "?";
            document.getElementById('matchDist').innerText = hDist + " miles away";
        }
    }

    document.getElementById('openCount').innerText = openCount;
    badge.innerText = openCount; badge.style.display = openCount > 0 ? "flex" : "none";
}

// Build Radius UI
const radBox = document.getElementById('radiusSelector');
radiusOptions.forEach(val => {
    const div = document.createElement('div'); div.className = 'radius-item';
    const label = val === 999999 ? 'Nation' : val + 'mi';
    div.innerHTML = `<input type="radio" name="rad" id="r${val}" value="${val}" ${val === 50 ? 'checked' : ''} onchange="window.setMyRadius(${val})">
                     <label class="radius-label" for="r${val}">${label}</label>`;
    radBox.appendChild(div);
});

navigator.geolocation.watchPosition(p => {
    userLocation = { lat: p.coords.latitude, lng: p.coords.longitude };
    update(ref(db, `profiles/${myId}`), { lat: userLocation.lat, lng: userLocation.lng, id: myId });
}, null, { enableHighAccuracy: true });

</script>
</body>
</html>









