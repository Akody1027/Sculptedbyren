<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mega Millions Predictor</title>
  <style>
    body {
      background: #F4EFFF;
      color: #333;
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      margin: 0;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: #FFFFFF;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
      padding: 30px;
    }
    h1 {
      text-align: center;
      color: #7F53FF;
      margin-bottom: 20px;
    }
    button {
      width: 100%;
      box-sizing: border-box;
      border-radius: 6px;
      border: none;
      font-size: 1rem;
      padding: 10px;
      margin: 10px 0;
      background: #B19AFF;
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    button:hover {
      background: #7F53FF;
    }
    #result {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .set {
      display: flex;
      justify-content: space-around;
    }
    .number {
      width: 50px;
      height: 50px;
      line-height: 50px;
      border-radius: 50%;
      font-size: 1.1rem;
      font-weight: bold;
      text-align: center;
      opacity: 0;
      transform: scale(0.8);
      animation: fadeIn 0.6s forwards;
    }
    .white {
      background: #FFF6F6;
      border: 2px solid #FFB3B3;
      color: #FF5C5C;
    }
    .mega {
      background: #FEF9E7;
      border: 2px solid #FFE599;
      color: #E1AD01;
    }
    textarea {
      width: 100%;
      box-sizing: border-box;
      border-radius: 6px;
      border: 1px solid #DDD;
      font-size: 1rem;
      padding: 10px;
      margin: 10px 0;
      transition: all 0.3s ease;
    }
    textarea:focus {
      border-color: #B19AFF;
      outline: none;
    }
    @keyframes fadeIn {
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Mega Millions Predictor</h1>
    <button id="generate">Generate 5 Sets</button>
    <div id="result"></div>

    <!-- Moved to bottom -->
    <textarea id="newDraw" rows="2" placeholder="Enter latest draw: MM-DD-YYYY W1 W2 W3 W4 W5 MB"></textarea>
    <button id="addDraw">Add Draw &amp; Recalculate Model</button>
  </div>

  <script>
  // Paste full history here:
  let historicalData = [
    // [MM,DD,YYYY,W1,W2,W3,W4,W5,Mega],
    // …
  ];

  const NUM_SETS = 5;

  function parseNewDraw(str) {
    const parts = str.trim().split(/[\s,-]+/);
    if (parts.length !== 9) return null;
    return parts.map(Number);
  }

  document.getElementById('addDraw').onclick = () => {
    const raw = document.getElementById('newDraw').value;
    const entry = parseNewDraw(raw);
    if (entry) {
      historicalData.push(entry);
      alert('✅ Draw added!');
      document.getElementById('newDraw').value = '';
    } else {
      alert('⚠️ Invalid format. Use: MM-DD-YYYY W1 W2 W3 W4 W5 MB');
    }
  };

  function getExpoProbs() {
    const halfLife = 500;
    const λ = Math.log(2) / halfLife;
    const N = historicalData.length;
    const weights = historicalData.map((_, i) => Math.exp(-λ * (N - 1 - i)));
    // white
    const wCount = Array(71).fill(0);
    historicalData.forEach((d,i) => {
      [d[3],d[4],d[5],d[6],d[7]].forEach(n => wCount[n]+=weights[i]);
    });
    const totalW = wCount.reduce((a,b)=>a+b,0);
    const whiteProbs = wCount.map(c=>c/totalW);
    // mega
    const mCount = Array(26).fill(0);
    historicalData.forEach((d,i) => mCount[d[8]]+=weights[i]);
    const totalM = mCount.reduce((a,b)=>a+b,0);
    const megaProbs = mCount.map(c=>c/totalM);
    return { whiteProbs, megaProbs };
  }

  function getTrendScores() {
    const N = historicalData.length;
    const idx = historicalData.map((_,i)=>i);
    const whiteScores = Array(71).fill(0), megaScores=Array(26).fill(0);
    // helper to corr
    function corr(xs, ys) {
      const mx = xs.reduce((a,b)=>a+b,0)/N;
      const my = ys.reduce((a,b)=>a+b,0)/N;
      let num=0, denx=0, deny=0;
      for(let i=0;i<N;i++){
        num+=(xs[i]-mx)*(ys[i]-my);
        denx+=(xs[i]-mx)**2; deny+=(ys[i]-my)**2;
      }
      return denx&&deny? num/Math.sqrt(denx*deny): 0;
    }
    for(let num=1;num<=70;num++){
      const ys = historicalData.map(d=>[d[3],d[4],d[5],d[6],d[7]].includes(num)?1:0);
      whiteScores[num] = corr(idx,ys);
    }
    for(let num=1;num<=25;num++){
      const ys = historicalData.map(d=>d[8]===num?1:0);
      megaScores[num] = corr(idx,ys);
    }
    return { whiteScores, megaScores };
  }

  function combineModels() {
    const { whiteProbs, megaProbs } = getExpoProbs();
    const { whiteScores, megaScores } = getTrendScores();
    // normalize trend to 0–1
    const white = whiteProbs.map((p,i)=>(p + (whiteScores[i]+1)/2)/2);
    const mega  = megaProbs.map((p,i)=>(p + (megaScores[i]+1)/2)/2);
    return { white, mega };
  }

  function weightedSample(pool, weights, k) {
    const cum = [];
    weights.reduce((sum,w,i)=>cum[i]=sum+w,0);
    const total = cum[cum.length-1];
    const chosen = new Set();
    while(chosen.size<k){
      const r = Math.random()*total;
      const idx = cum.findIndex(c=>r<c);
      if(idx>0) chosen.add(pool[idx]);
    }
    return Array.from(chosen);
  }

  function generate() {
    const { white, mega } = combineModels();
    const res = document.getElementById('result');
    res.innerHTML = '';
    for(let s=0;s<NUM_SETS;s++){
      const setDiv = document.createElement('div');
      setDiv.className = 'set';
      // sample 5 whites
      const whites = weightedSample(
        [...Array(71).keys()].slice(1),
        white.slice(1),
        5
      );
      whites.forEach(n=>{
        const d=document.createElement('div');
        d.className='number white';
        d.textContent=n;
        setDiv.appendChild(d);
      });
      // sample 1 mega
      const mb = weightedSample(
        [...Array(26).keys()].slice(1),
        mega.slice(1),
        1
      )[0];
      const dm=document.createElement('div');
      dm.className='number mega';
      dm.textContent=mb;
      setDiv.appendChild(dm);

      res.appendChild(setDiv);
    }
  }

  document.getElementById('generate').onclick = generate;
  </script>
</body>
</html>
