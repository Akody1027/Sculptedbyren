<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mega Millions Smart Predictor — Enhanced</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 30px; background: #f0f0f0; }
    h1 { color: #333; }
    button { padding: 15px 30px; font-size: 18px; margin: 20px; border-radius: 8px; background: #222; color: #fff; border: none; cursor: pointer; }
    .numbers, .history, .heatmap { margin-top: 30px; }
    .numbers { font-size: 26px; }
    .history { text-align: left; max-width: 600px; margin: 20px auto; background: #fff; padding: 15px; border-radius: 8px; }
    .ball { display: inline-block; width: 40px; height: 40px; line-height: 40px; margin: 3px; border-radius: 50%; color: #fff; font-weight: bold; }
    .heatmap { display: flex; flex-wrap: wrap; max-width: 600px; margin: 0 auto; }
    .disclaimer { color: red; font-weight: bold; margin-top: 30px; }
  </style>
</head>
<body>

<h1>Mega Millions Smart Predictor — Enhanced</h1>
<button onclick="generateNumbers()">Generate Smart Numbers</button>

<div class="numbers" id="output"></div>
<div class="heatmap" id="heatmap"></div>
<div class="history" id="history"><strong>Pick History:</strong><br></div>
<div class="disclaimer">** Disclaimer: This tool uses historical trends but cannot guarantee winning numbers. Play responsibly. **</div>

<script>
  const weightedWhiteBalls = [
    3,3,3,4,10,10,17,17,22,22,31,31,36,36,46,46,48,48,58,58,63,64,64,66,66,69,69
  ];
  const weightedMegaBalls = [3,11,11,13,18,18,22,22,24,24];
  const allWhiteBalls = Array.from({length:70},(_,i)=>i+1);
  const allMegaBalls = Array.from({length:25},(_,i)=>i+1);
  let pickHistory = [];

  // Function to check if last draw was used
  function lastDrawAvoidance(whiteBalls) {
    const lastDraw = pickHistory[0]?.split(' | ')[0].replace('White: ', '').split(', ').map(Number);
    return lastDraw && !whiteBalls.every(n => lastDraw.includes(n));
  }

  function generateNumbers() {
    let whiteBalls = [];
    while (whiteBalls.length < 5) {
      let n = weightedWhiteBalls[Math.floor(Math.random() * weightedWhiteBalls.length)];
      if (!whiteBalls.includes(n)) whiteBalls.push(n);
    }

    whiteBalls.sort((a, b) => a - b);

    // Apply avoidance of consecutive numbers
    if (whiteBalls.some((n, i) => i > 0 && n === whiteBalls[i - 1] + 1)) return generateNumbers();

    // Apply last draw avoidance
    if (!lastDrawAvoidance(whiteBalls)) return generateNumbers();

    // Apply number aging algorithm: boost rarely drawn numbers
    whiteBalls.forEach(n => {
      const age = 100 - weightedWhiteBalls.filter(x => x === n).length;
      if (age > 10) weightedWhiteBalls.push(n); // Boost aging numbers
    });

    // Ensure range distribution (no more than 3 numbers from any range)
    let ranges = [0, 0, 0];
    whiteBalls.forEach(n => {
      if (n <= 23) ranges[0]++;
      else if (n <= 46) ranges[1]++;
      else ranges[2]++;
    });
    if (Math.max(...ranges) > 3) return generateNumbers();

    // Random MegaBall generation with frequency adjustment
    let megaBall = weightedMegaBalls[Math.floor(Math.random() * weightedMegaBalls.length)];

    // Add to history and render
    let pick = `White: ${whiteBalls.join(", ")} | Mega: ${megaBall}`;
    pickHistory.unshift(pick);
    updateHistory();
    renderHeatmap(whiteBalls, megaBall);
    document.getElementById("output").innerHTML = `<strong>${pick}</strong>`;
  }

  function updateHistory() {
    document.getElementById("history").innerHTML = "<strong>Pick History:</strong><br>" + pickHistory.join("<br>");
  }

  function renderHeatmap(whites, mega) {
    const heatmap = document.getElementById("heatmap");
    heatmap.innerHTML = "";
    allWhiteBalls.forEach(n => {
      let freq = weightedWhiteBalls.filter(x => x === n).length;
      let color = whites.includes(n) ? "#32cd32" : freq > 2 ? "#ff4500" : freq > 0 ? "#ffa500" : "#ccc";
      heatmap.innerHTML += `<div class="ball" style="background:${color}">${n}</div>`;
    });
    heatmap.innerHTML += `<div style="flex-basis:100%;height:20px;"></div>`;
    allMegaBalls.forEach(n => {
      let freq = weightedMegaBalls.filter(x => x === n).length;
      let color = (mega === n) ? "#32cd32" : freq > 2 ? "#0066cc" : freq > 0 ? "#00bfff" : "#ccc";
      heatmap.innerHTML += `<div class="ball" style="background:${color}">${n}</div>`;
    });
  }
</script>

</body>
</html>
