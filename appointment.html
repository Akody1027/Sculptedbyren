<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mega Millions Generator + Chat</title>
<style>
  body{font-family:system-ui,Roboto,Helvetica,Arial,sans-serif;background:#f4f6f8;margin:0;padding:2rem;color:#111}
  .panel{max-width:640px;margin:auto}
  .balls{display:flex;gap:.5rem;margin-bottom:1rem}
  .ball{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;box-shadow:0 2px 4px rgb(0 0 0 / .2)}
  .white{background:#fff}
  .yellow{background:#fed049}
  button{padding:.8rem 1.4rem;font-size:1rem;border:none;border-radius:.5rem;background:#111;color:#fff;cursor:pointer}
  /* Chat UI */
  #chatbox{height:300px;overflow-y:auto;background:#fff;border:1px solid #ddd;border-radius:.5rem;padding:1rem;margin-top:2rem}
  .msg{display:flex;gap:.5rem;margin-bottom:1rem}
  .ai   {.msg-bubble{background:#e8f0fe}}
  .user {.msg-bubble{background:#dcf8c6; margin-left:auto}}
  .msg-bubble{padding:.6rem 1rem;border-radius:1rem;max-width:80%}
  textarea{width:100%;height:60px;margin-top:.5rem;padding:.6rem;font-size:1rem}
</style>
</head>
<body>
<div class="panel">
  <h1>Mega Millions Smart Picker</h1>

  <!-- Generated numbers go here -->
  <div id="numbers" class="balls"></div>
  <button id="generate">Generate Numbers</button>

  <!-- ChatGPT-style panel -->
  <div id="chatbox"></div>
  <textarea id="prompt" placeholder="Ask how these numbers were chosen…"></textarea>
  <button id="send">Ask AI</button>
</div>

<script>
// ---------- LOTTERY PICKER ----------
function smartPick(){
  // SIMPLE demo: replace with your full algorithm
  const whitePool=[...Array(70).keys()].map(n=>n+1);
  const megaPool=[...Array(25).keys()].map(n=>n+1);
  const shuffle=a=>a.sort(()=>Math.random()-0.5);
  let whites=shuffle(whitePool).slice(0,5).sort((a,b)=>a-b);
  let mega =shuffle(megaPool)[0];
  return {whites,mega};
}

function renderBalls(set){
  const box=document.getElementById('numbers');
  box.innerHTML='';
  set.whites.forEach(n=>{
    const b=document.createElement('div');
    b.className='ball white';
    b.textContent=n;
    box.appendChild(b);
  });
  const mb=document.createElement('div');
  mb.className='ball yellow';
  mb.textContent=set.mega;
  box.appendChild(mb);
}

// ---------- CHAT HANDLER ----------
async function chat(prompt){
  const chatbox=document.getElementById('chatbox');
  addMsg(prompt,'user');

  const res=await fetch('/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({messages:[{role:'user',content:prompt}]})
  });
  const data=await res.json();
  addMsg(data.reply,'ai');
  chatbox.scrollTop=chatbox.scrollHeight;
}

function addMsg(text,who){
  const chatbox=document.getElementById('chatbox');
  const wrap=document.createElement('div');
  wrap.className='msg '+who;
  const bubble=document.createElement('div');
  bubble.className='msg-bubble';
  bubble.textContent=text;
  wrap.appendChild(bubble);
  chatbox.appendChild(wrap);
}

// ---------- HOOK UP BUTTONS ----------
let lastPick=null;

document.getElementById('generate').onclick=()=>{
  lastPick=smartPick();
  renderBalls(lastPick);
  addMsg('Numbers generated – ask me anything about them!','ai');
};

document.getElementById('send').onclick=()=>{
  const prompt=document.getElementById('prompt');
  if(!prompt.value.trim()) return;
  // feed the pick into the prompt so ChatGPT can “explain” it
  const fullPrompt=`Here are the numbers: ${lastPick?lastPick.whites.join(' ')+
        ' Mega '+lastPick.mega:'(none yet)'}.\nUser asks: ${prompt.value}`;
  chat(fullPrompt);
  prompt.value='';
};
</script>
</body>
</html>
